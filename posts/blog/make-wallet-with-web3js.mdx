---
title: web3.jsë¡œ ê°„ë‹¨í•œ ì§€ê°‘ ë§Œë“¤ê¸° (feat. ganache, next.js)
description: web3.js, ganache, next.jsë¡œ ê°„ë‹¨í•œ ì§€ê°‘ì„ ë§Œë“¤ì–´ë³´ì
date: 2023-09-16
tags: [web3.js, ganache, ë¸”ë¡ì²´ì¸, dApp, next.js]
isPublished: true
imgUrl: make-wallet-with-web3js.jpeg
---

web3.js, ganache, next.jsë¡œ ê°„ë‹¨í•œ ì§€ê°‘ì„ ë§Œë“¤ê²Œ ë˜ì—ˆëŠ”ë° ê·¸ ê³¼ì •ì„ ë¸”ë¡œê·¸ì— ê¸°ë¡í•´ë³´ë ¤ê³  í•œë‹¤.
ê¸€ ì œëª©ê³¼ ì„¤ëª…ì— ì§€ê°‘ì´ë¼ê³  ì ê¸´ í–ˆì§€ë§Œ.. ì‚¬ì‹¤ ì€í–‰ ì–´í”Œê³¼ ê°™ì´ ì´ë”ë¦¬ì›€ì„ ì¡°íšŒï½¥ì´ì²´í•˜ê³ , ì´ì²´ ë‚´ì—­ì„ ì¡°íšŒí•˜ëŠ” ê°„ë‹¨í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤.

## ì‹œì‘

ganacheë¥¼ ì‚¬ìš©í•˜ë©´ ë¡œì»¬ ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆë‹¤.

ì‹¤ì œ ë¸”ë¡ì²´ì¸ ë…¸ë“œì™€ í†µì‹ í•˜ë ¤ë©´ infura ë˜ëŠ” metamaskë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ë‚˜, ë‚˜ëŠ” web3.jsë¥¼ ì‚¬ìš©í•´ë³´ëŠ” ê²ƒì— ì´ˆì ì„ ë‘ì—ˆê¸° ë•Œë¬¸ì— ganacheë¥¼ ì‚¬ìš©í–ˆë‹¤.

`next.js`ë¡œ í”„ë¡ íŠ¸ í™”ë©´ê³¼ apië¥¼ êµ¬í˜„í•˜ì—¬ ê°„ë‹¨í•œ ì§€ê°‘ì„ ë§Œë“¤ì–´ë³´ì.

## next.js, web3.js, ganache ì„¤ì¹˜

next.js í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  web3, ganache ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•œë‹¤.

```shell
> npx create-next-app@latest web3js
> cd web3js
> npm install web3 ganache
```

ganacheë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤. ganacheë¥¼ ë”°ë¡œ ì‹¤í–‰í•˜ë“ ì§€ ì•„ë‹ˆë©´ devì— ë„£ì–´ì„œ nextì™€ í•¨ê»˜ ì‹¤í–‰ë˜ë„ë¡ ë§Œë“ ë‹¤. ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```json
"scripts": {
  "dev": "ganache --wallet.seed myCustomSeed & next dev",
  "build": "next build",
  "start": "next start",
  "lint": "next lint",
  "ganache": "ganache --wallet.seed myCustomSeed"
},
```

ganacheë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ê°€ìƒ accountì™€ ì´ë”ë¦¬ì›€ì´ ë°œê¸‰ëœë‹¤. ë‚˜ëŠ” ì œê³µë°›ì€ accountì˜ ê³„ì¢Œ ì”ì•¡ì„ í™•ì¸í•˜ê³  ë‹¤ë¥¸ ê³„ì¢Œë¡œ ì´ë”ë¦¬ì›€ì„ ì´ì²´í•˜ëŠ” í™”ë©´ê³¼, ì´ì²´ ë‚´ì—­ì„ í™•ì¸í•˜ëŠ” í™”ë©´ì„ ë§Œë“¤ ê²ƒì´ë‹¤.

![ganache ì‹¤í–‰](https://github.com/yunjeoming/yuns-blog/assets/76480300/2c03532b-14ad-47c8-b66f-3637275b532e)

## api êµ¬í˜„

í”„ë¡ íŠ¸ì—ì„œëŠ” web3.jsë¥¼ ë°”ë¡œ í˜¸ì¶œí•˜ì§€ ì•Šê³  ëŒ€ì‹ ì— apië¥¼ í˜¸ì¶œí•˜ë ¤ê³  í•œë‹¤. ë”°ë¼ì„œ, ì´ì— ë§ëŠ” apië¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë° next.jsì—ì„œëŠ” ìì²´ apië¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. web3.jsë¡œ apië¥¼ ì–´ë–»ê²Œ êµ¬í˜„í•  ê²ƒì¸ì§€ì— ì¤‘ì ì„ ë‘” ê¸€ì´ê¸° ë•Œë¬¸ì— next.jsì—ì„œ apië¥¼ êµ¬í˜„í•˜ëŠ” ìì„¸í•œ ë°©ë²•ì€ ìƒëµí•œë‹¤. ë§Œì•½ ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ì•„ë˜ ê³µì‹ ë¬¸ì„œë¥¼ ì½ì–´ë³´ìğŸ˜

ğŸ“ Next.jsì—ì„œ api ë§Œë“œëŠ” ë°©ë²• - [Next.js ê³µì‹ ë¬¸ì„œ ë°”ë¡œê°€ê¸°](https://nextjs.org/docs/pages/building-your-application/routing/api-routes)

### web3.js ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ê¸°

web3.jsë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ê³  provider ì„¤ì •ì„ í•´ì•¼í•œë‹¤.

ganacheë¥¼ ì‹¤í–‰í•˜ë©´ í•˜ë‹¨ì— `RPC Listening on 127.0.0.1:8545`ê°€ ì¶œë ¥ë˜ë©° í¬íŠ¸ ë²ˆí˜¸ê°€ ë‚˜ì˜¤ëŠ”ë°, ì´ ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ web3 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë§Œë“ ë‹¤.

```ts
import Web3 from 'web3';

const BASE_URL = 'http://127.0.0.1:8545';

const web3Instance = new Web3(new Web3.providers.HttpProvider(BASE_URL));

export default web3Instance;
```

### accounts api

#### ï½¥ ëª¨ë“  ê³„ì¢Œ ì¡°íšŒ

```shell
# ëª¨ë“  ê³„ì¢Œ ì¡°íšŒ
GET /api/accounts
```

web3 ì¸ìŠ¤í„´ìŠ¤ë¡œë¶€í„° ì—°ê²°ëœ ì£¼ì†Œì˜ ëª¨ë“  ê³„ì¢Œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 

```ts
const web3 = web3Instance;
const accounts = await web3.eth.getAccounts();

res.status(200).json({
  accounts,
});
```

#### ï½¥ íŠ¹ì • ê³„ì¢Œ ì”ì•¡ ì¡°íšŒ

```shell
# íŠ¹ì • ê³„ì¢Œ ì”ì•¡ ì¡°íšŒ
GET /api/accounts/{id}
```

getBalanceë¡œ ì–»ì€ ì”ì•¡ì€ ë‹¨ìœ„ê°€ weiì´ë‹¤. í”„ë¡ íŠ¸ì—ì„œëŠ” ether ë‹¨ìœ„ë¡œ í™˜ì „ì„ ì§„í–‰í•  ê²ƒì´ê¸° ë•Œë¬¸ì— `wei -> ether`ë¡œ ë‹¨ìœ„ë¥¼ ë°”ê¾¼ë‹¤.

weiBalanceê°€ 0ì¼ ê²½ìš° `fromWei`ë¡œ ë³€í™˜í•œ ethBalanceëŠ” `0.`ì´ ëœë‹¤. ì´ ë¶€ë¶„ì„ ê³ ë ¤í•˜ì—¬ ê³„ì¢Œ ì”ì•¡ì„ ì˜ ê°€ê³µí•˜ì—¬ responseì— ë„˜ê²¨ì¤€ë‹¤.

```ts
const weiBalance = await web3.eth.getBalance(id);
const ethBalance = Web3.utils.fromWei(weiBalance, 'ether');

res.status(200).json({
  name: id.toString(),
  balance: ethBalance === '0.' ? '0' : ethBalance,
});
```

### transactions api

#### ï½¥ ì´ì²´í•˜ê¸° (íŠ¸ëœì­ì…˜ ìƒì„±)

```shell
# ì´ì²´í•˜ê¸° (íŠ¸ëœì­ì…˜ ìƒì„±)
POST /api/transactions

{
  fromAccount: ë³´ë‚´ëŠ” ê³„ì¢Œ
  toAccount: ë°›ëŠ” ê³„ì¢Œ
  amount: ì´ì²´ ê¸ˆì•¡
}
```

body ê°ì²´ì˜ í”„ë¡œí¼í‹°ëŠ” ë” ì‰½ê²Œ ì•Œì•„ë³´ê¸° ìœ„í•´ fromAccount, toAccount, amountë¡œ ëª…ëª…í–ˆë‹¤.

amountì˜ ë‹¨ìœ„ëŠ” etherì´ë¯€ë¡œ weië¡œ ë³€í™˜í•´ì¤€ë‹¤. íŠ¸ëœì­ì…˜ ìƒì„±ì— í•„ìš”í•œ gasPrice, gasLimitë„ ì„¤ì •í•´ì¤€ë‹¤.

ğŸ“ *gasPriceë€? (feat. GPT)*
```
gasPriceëŠ” ë‹¨ìœ„ ê°€ìŠ¤ë‹¹ ì´ë”(ETH) ê°€ê²©ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë§ˆì´ë„ˆ(ë¸”ë¡ì„ ìƒì„±í•˜ëŠ” ë…¸ë“œ)ì—ê²Œ ì§€ë¶ˆí•˜ëŠ” ë¹„ìš©ì„ ê²°ì •í•©ë‹ˆë‹¤. ë†’ì€ gasPriceë¥¼ ì„¤ì •í•˜ë©´ íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ìš°ì„ ìˆœìœ„ê°€ ë†’ì•„ì§€ë©°, ë§ˆì´ë„ˆë“¤ì€ ë” ë†’ì€ ë³´ìƒì„ ë°›ê¸° ìœ„í•´ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë ¤ê³  í•  ê²ƒì…ë‹ˆë‹¤.
```

ğŸ“ *gasLimitë€? (feat. GPT)*
```
gasLimitëŠ” íŠ¸ëœì­ì…˜ì´ ì†Œë¹„í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ê°€ìŠ¤ ì–‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ê°’ì€ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ í•„ìš”í•œ ê³„ì‚° ë° ìŠ¤í† ë¦¬ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš© ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤ì˜ í•œë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. gasLimitë¥¼ ë†’ê²Œ ì„¤ì •í•˜ë©´ ë” ë³µì¡í•œ ì—°ì‚° ë˜ëŠ” ê³„ì•½ ì‹¤í–‰ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ, ë†’ì€ gasLimitëŠ” ë†’ì€ ë¹„ìš©ì„ ì˜ë¯¸í•˜ë©°, ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ì—ì„œëŠ” íŠ¸ëœì­ì…˜ ì²˜ë¦¬ì— ëŒ€í•œ ê°€ìŠ¤ ë¹„ìš©ì„ ì§€ë¶ˆí•´ì•¼ í•©ë‹ˆë‹¤.
```

```ts
const transaction = {
  to: toAccount,
  from: fromAccount,
  value: web3.utils.toWei(amount, 'ether').toString(),
};

const gasPrice = await web3.eth.getGasPrice();
const gasLimit = await web3.eth.estimateGas(transaction);

const transactionResult = await web3.eth.sendTransaction({
  ...transaction,
  gasLimit: gasLimit.toString(),
  gasPrice: gasPrice.toString(),
});

res.status(201).json({
  ...transaction,
  txId: transactionResult.transactionHash,
  value: amount,
});
```

#### ï½¥ íŠ¹ì • íŠ¸ëœì­ì…˜ ì¡°íšŒ

```shell
# íŠ¹ì • íŠ¸ëœì­ì…˜ ì¡°íšŒ
GET /api/transactions/{id}
```

ìƒì„±ëœ íŠ¸ëœì­ì…˜ë“¤ì„ ì¡°íšŒí•˜ëŠ” apiì´ë‹¤. idì— í•´ë‹¹í•˜ëŠ” íŠ¸ëœì­ì…˜ì´ ì—†ì„ ê²½ìš°ì— 404 ì²˜ë¦¬í•œë‹¤.

```ts
const transaction = await web3.eth.getTransaction(id);

if (!transaction) {
  return res.status(404).json({
    text: 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” íŠ¸ëœì­ì…˜ì…ë‹ˆë‹¤.',
  });
}

const transactionResult = {
  to: transaction.to,
  from: transaction.from,
  value: web3.utils.fromWei(transaction.value, 'ether').toString(),
};

res.status(200).json({
  ...transactionResult,
  txId: id,
});
```

#### ï½¥ íŠ¸ëœì­ì…˜ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ

```shell
# íŠ¸ëœì­ì…˜ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ
GET /api/transactions/fee
```

íŠ¸ëœì­ì…˜ ìƒì„±ì‹œ ìˆ˜ìˆ˜ë£Œ(ether, gas)ê°€ í•„ìš”í•œë°, í”„ë¡ íŠ¸ í™”ë©´ í•˜ë‹¨ì— ì¡°ê·¸ë§£ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ìˆ˜ìˆ˜ë£Œ ì¡°íšŒ apië¥¼ ë”°ë¡œ ë§Œë“¤ì—ˆë‹¤.

ìˆ˜ìˆ˜ë£ŒëŠ” gasPrice * gasLimit (ether ë‹¨ìœ„) ë§Œí¼ ì†Œëª¨ë˜ëŠ”ë°, valueê°€ ì–´ë– í•œ ê°’ì´ë“  gasLimitì€ í•­ìƒ ê°™ê¸¸ë˜ valueëŠ” 0ìœ¼ë¡œ ê³ ì •ì‹œì¼œ ê°€ì§œ íŠ¸ëœì­ì…˜ì„ ë§Œë“¤ì–´ gasLimitì„ êµ¬í–ˆë‹¤.

```ts
// ì„ì˜ ì£¼ì†Œ
const fakeTransaction = {
  to: '0xf318EDEe6c856606814C0DC3d971dceA82bF071c',
  from: '0xf318EDEe6c856606814C0DC3d971dceA82bF071c',
  value: web3.utils.toWei('0', 'ether').toString(),
};
const gasPrice = await web3.eth.getGasPrice();
const gasLimit = await web3.eth.estimateGas(fakeTransaction);

res.status(200).json({
  fee: web3.utils.fromWei(gasPrice * gasLimit, 'ether'),
});
```

## í™”ë©´ êµ¬í˜„

web3.jsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ì´ˆì ì„ ë‘” ê¸€ì´ê¸° ë•Œë¬¸ì— í™”ë©´ êµ¬í˜„ì— ëŒ€í•œ ìì„¸í•œ ë°©ë²•ê³¼ ì½”ë“œëŠ” ìƒëµí•˜ê³  ê°„ëµí•˜ê²Œ ì„¤ëª…í•˜ë ¤ê³  í•œë‹¤.

í™”ë©´ì€ 2ê°œì˜ íƒ­ìœ¼ë¡œ ë‚˜ëˆ„ì—ˆê³  í•˜ë‚˜ëŠ” Accounts, í•˜ë‚˜ëŠ” Transactionsë¡œ ëª…ëª…í–ˆë‹¤.

Accounts íƒ­ì—ì„œëŠ” ganacheë¡œë¶€í„° ì œê³µë°›ì€ ëª¨ë“  ê³„ì¢Œì™€ ê³„ì¢Œì˜ ì”ì•¡ì„ ë³´ì—¬ì£¼ê³ , ë‹¤ë¥¸ ê³„ì¢Œë¥¼ ì„ íƒí•˜ì—¬ ë³´ìœ  ì”ì•¡ ì´ë‚´ë¡œ ì´ë”ë¦¬ì›€ì„ ì´ì²´í•  ìˆ˜ ìˆë‹¤. Transactions íƒ­ì—ì„œëŠ” Accounts íƒ­ì—ì„œ ìƒì„±ëœ ëª¨ë“  íŠ¸ëœì­ì…˜ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ, ìƒì„±ë˜ëŠ” íŠ¸ëœì­ì…˜ì„ ì €ì¥í•˜ê¸° ìœ„í•´ reduxë¥¼ ì‚¬ìš©í–ˆê³  ë˜í•œ ìƒˆ íŠ¸ëœì­ì…˜ì˜ ìƒì„± ì‹œê°„ì´ ì—†ì–´ì„œ íŠ¸ëœì­ì…˜ idë³„ ìƒì„± ì‹œê°„ì„ ë³„ë„ë¡œ ì €ì¥í–ˆë‹¤.

reduxë¥¼ ì‚¬ìš©í•˜ëŠ” ê¹€ì—, apië¥¼ í˜¸ì¶œí•  ë•Œ ì´ì „ì— ì”ì•¡ì´ ì¡°íšŒë˜ì—ˆë˜ ê³„ì¢Œì˜ ê²½ìš° apië¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ í–ˆë‹¤. íŠ¸ëœì­ì…˜ ë˜í•œ Transactions íƒ­ì„ í´ë¦­í–ˆì„ ë•Œ ì´ì „ì— ë¶ˆëŸ¬ì˜¨ ë‚´ìš©ì¼ ê²½ìš° ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šë„ë¡ í–ˆë‹¤.

### Accounts í™”ë©´

- ë©”ì¸ í™”ë©´
![main screen](https://github.com/yunjeoming/yuns-blog/assets/76480300/9ff87acc-ddd6-454a-81e6-8bdf13128c5f)

- ê³„ì¢Œ ì„ íƒ
![select account](https://github.com/yunjeoming/yuns-blog/assets/76480300/ad3b3faa-4397-4191-952b-55267f2c7f87)

- í™˜ì „ ì™„ë£Œ
![exchange](https://github.com/yunjeoming/yuns-blog/assets/76480300/b85d1e0d-dd78-4894-8112-3f05aa6c91a0)

### Transactions í™”ë©´

- ê±°ë˜ ë‚´ì—­ í™•ì¸
![transactions screen](https://github.com/yunjeoming/yuns-blog/assets/76480300/b6745e83-cf83-44de-8c95-9213496f65c7)

## ë§ˆì¹˜ë©°

ìœ„ ì½”ë“œëŒ€ë¡œ ë§Œë“  ê²°ê³¼ë¬¼ì„ ë³´ë©´ web3.jsì˜ ì•„-ì£¼ ê¸°ë³¸ì ì¸ ë‚´ìš©ë§Œì„ ë‹¤ë£¬ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. 
ê²°ê³¼ë¬¼ì€ ê°„ë‹¨í•˜ì§€ë§Œ ì‚¬ì‹¤, ì´ ê°„ë‹¨í•œ ê²°ê³¼ë¬¼ì„ ê¸ˆë°© ë§Œë“¤ì–´ë‚¸ ê±´ ì•„ë‹ˆì—ˆë‹¤.
ë¸”ë¡ì²´ì¸ì— ëŒ€í•´ ì°¾ì•„ë³´ê³  ê·¸ ê°œë…ê³¼ ì›ë¦¬ë¥¼ ì´í•´í•˜ë©° ëª¨ë¥´ëŠ” ë¶€ë¶„ì„ ê²€ìƒ‰í•˜ëŠ”ë° ìŸì€ ì‹œê°„ë„ ì ì§€ ì•Šì•˜ë‹¤.
ê·¸ë ‡ê¸°ì— ê²°ê³¼ë¬¼ì´ ë¹„ë¡.. ê°„ë‹¨í•´ë³´ì´ê³  ì—†ì–´ë³´ì¼ì§€ ì–¸ì • ë¸”ë¡ì²´ì¸ì„ ì‹œê°„ë‚´ì„œ ê³µë¶€í•˜ê²Œ ëœ ëœ»ê¹Šì€ ì‹œê°„ì´ ì•„ë‹ê¹Œ ì‹¶ë‹¤.

ê·¸ë¦¬ê³  ê³µë¶€ë¥¼ ë” í•´ì•¼í•œë‹¤ë©´ ìœ„ ì½”ë“œì—ì„œ í•„ìš”í•œ ë¶€ë¶„ì„ ì¶”ê°€í•˜ë©´ì„œ ì‚´ì„ ë§ë¶™ì—¬ ê°€ë©´ ë˜ì§€ ì•Šì„ê¹ŒğŸ˜‰

(ë¸”ë¡ì²´ì¸, web3.jsë¥¼ ê³µë¶€í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤! ì˜ëª»ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš” :-D)

## ì°¸ê³ 
[https://web3js-kr.readthedocs.io/ko/latest/index.html](https://web3js-kr.readthedocs.io/ko/latest/index.html)
